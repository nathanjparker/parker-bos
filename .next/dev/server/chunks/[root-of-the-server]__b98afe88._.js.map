{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/NathanParker/SynologyDrive/parker-bos/src/app/api/enhance-description/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nconst ANTHROPIC_API_URL = \"https://api.anthropic.com/v1/messages\";\n\nexport async function POST(request: Request) {\n  const apiKey = process.env.ANTHROPIC_API_KEY;\n  if (!apiKey) {\n    return NextResponse.json(\n      { error: \"Enhancement is not configured (missing API key).\" },\n      { status: 503 }\n    );\n  }\n\n  let body: { description?: string };\n  try {\n    body = await request.json();\n  } catch {\n    return NextResponse.json(\n      { error: \"Invalid JSON body.\" },\n      { status: 400 }\n    );\n  }\n\n  const description = typeof body.description === \"string\" ? body.description.trim() : \"\";\n  if (!description) {\n    return NextResponse.json(\n      { error: \"Description is required.\" },\n      { status: 400 }\n    );\n  }\n\n  const userPrompt = `Transform this field note into a professional change order description following these guidelines:\n\nREQUIREMENTS:\n- Be concise (2-3 sentences maximum)\n- Lead with the primary change/addition\n- Include specific quantities, locations, and materials when mentioned\n- Use professional construction terminology\n- State reason for change if provided (customer request, code requirement, field condition, etc.)\n- Remove filler words, casual language, and abbreviations\n- Maintain factual accuracy - don't add information not in the original\n\nTONE: Professional but clear, suitable for contractor-client communication\n\nINPUT: ${description}\n\nOUTPUT: Only the enhanced description, no preamble or explanation.`;\n\n  try {\n    const res = await fetch(ANTHROPIC_API_URL, {\n      method: \"POST\",\n      headers: {\n        \"x-api-key\": apiKey,\n        \"anthropic-version\": \"2023-06-01\",\n        \"content-type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        model: \"claude-sonnet-4-20250514\",\n        max_tokens: 500,\n        system: \"You are a professional construction documentation assistant specializing in change order descriptions. Your goal is to transform rough field notes into clear, professional descriptions that satisfy both internal documentation needs and client-facing communication standards.\",\n        messages: [{ role: \"user\", content: userPrompt }],\n      }),\n    });\n\n    const data = await res.json().catch(() => ({}));\n\n    if (!res.ok) {\n      const message = (data.error?.message as string) || res.statusText || \"Anthropic API error\";\n      return NextResponse.json(\n        { error: message },\n        { status: 500 }\n      );\n    }\n\n    const content = data.content;\n    if (!Array.isArray(content) || content.length === 0) {\n      return NextResponse.json(\n        { error: \"No enhanced text returned.\" },\n        { status: 500 }\n      );\n    }\n\n    const firstBlock = content[0];\n    const text = firstBlock?.text;\n    if (typeof text !== \"string\") {\n      return NextResponse.json(\n        { error: \"Invalid response format.\" },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({ enhanced: text.trim() });\n  } catch (err) {\n    const message = err instanceof Error ? err.message : \"Enhancement failed.\";\n    return NextResponse.json(\n      { error: message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,oBAAoB;AAEnB,eAAe,KAAK,OAAgB;IACzC,MAAM,SAAS,QAAQ,GAAG,CAAC,iBAAiB;IAC5C,IAAI,CAAC,QAAQ;QACX,OAAO,+PAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAmD,GAC5D;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI;IACJ,IAAI;QACF,OAAO,MAAM,QAAQ,IAAI;IAC3B,EAAE,OAAM;QACN,OAAO,+PAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAqB,GAC9B;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,cAAc,OAAO,KAAK,WAAW,KAAK,WAAW,KAAK,WAAW,CAAC,IAAI,KAAK;IACrF,IAAI,CAAC,aAAa;QAChB,OAAO,+PAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,aAAa,CAAC;;;;;;;;;;;;;OAaf,EAAE,YAAY;;kEAE6C,CAAC;IAEjE,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,mBAAmB;YACzC,QAAQ;YACR,SAAS;gBACP,aAAa;gBACb,qBAAqB;gBACrB,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,YAAY;gBACZ,QAAQ;gBACR,UAAU;oBAAC;wBAAE,MAAM;wBAAQ,SAAS;oBAAW;iBAAE;YACnD;QACF;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAE7C,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,UAAU,AAAC,KAAK,KAAK,EAAE,WAAsB,IAAI,UAAU,IAAI;YACrE,OAAO,+PAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAQ,GACjB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,KAAK,OAAO;QAC5B,IAAI,CAAC,MAAM,OAAO,CAAC,YAAY,QAAQ,MAAM,KAAK,GAAG;YACnD,OAAO,+PAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,OAAO,CAAC,EAAE;QAC7B,MAAM,OAAO,YAAY;QACzB,IAAI,OAAO,SAAS,UAAU;YAC5B,OAAO,+PAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,+PAAY,CAAC,IAAI,CAAC;YAAE,UAAU,KAAK,IAAI;QAAG;IACnD,EAAE,OAAO,KAAK;QACZ,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;QACrD,OAAO,+PAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAQ,GACjB;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}